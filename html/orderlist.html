<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="ThemeBucket">
		<link rel="shortcut icon" href="#" type="image/png">

		<title>Basic Table</title>
		<style>
			.add-on {
				display: inline-block;
				height: 26px;
				min-width: 16px;
				padding: 6px 5px;
				font-size: 14px;
				font-weight: normal;
				line-height: 20px;
				text-align: center;
				text-shadow: 0 1px 0 #ffffff;
				border: 1px solid #999;
				border-left: none;
				border-radius: 0 20% 20% 0;
				margin-top: -37px;
			}
			
			.icon-th {
				display: inline-block;
				width: 14px;
				height: 14px;
				line-height: 14px;
				vertical-align: text-top;
				background-position: -240px 0;
				background-image: url(../img/glyphicons-halflings.png);
				background-repeat: no-repeat;
				margin-top: 1px;
			}
		</style>
		<link href="../css/style1.css" rel="stylesheet">
		<link href="../css/style-responsive.css" rel="stylesheet">
		<link rel="stylesheet" href="../css/page.css" />
		<!--日期选择部分-->
		<link rel="stylesheet" href="../js/bootstrap-datetimepicker-master/css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
		<!--日期选择部分结束-->
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
    <script src="../js/html5shiv.js"></script>
    <script src="../js/respond.min.js"></script>

    <script src="../js/jquery-1.4.3.js"></script>
    <![endif]-->
	</head>

	<body class="sticky-header">

		<section>
			<!-- left side start-->
			<div class="left-side sticky-left-side">

				<!--logo and iconic logo start-->
				<div class="logo">
					<a href="index.html"><img src="../img/logo1.png" alt=""></a>
				</div>

				<div class="logo-icon text-center">
					<a href="index.html"><img src="../img/logo_icon.png" alt=""></a>
				</div>
				<!--logo and iconic logo end-->

				<div class="left-side-inner">

					<!-- visible to small devices only -->
					<div class="visible-xs hidden-sm hidden-md hidden-lg">
						<div class="media logged-user">
							<img alt="" src="../img/photos/user-avatar.png" class="media-object">
							<div class="media-body">
								<h4><a href="#">John Doe</a></h4>
								<span>"Hello There..."</span>
							</div>
						</div>

						<h5 class="left-nav-title">Account Information</h5>
						<ul class="nav nav-pills nav-stacked custom-nav">
							<li>
								<a href="#"><i class="fa fa-user"></i> <span>Profile</span></a>
							</li>
							<li>
								<a href="#"><i class="fa fa-cog"></i> <span>Settings</span></a>
							</li>
							<li>
								<a href="#"><i class="fa fa-sign-out"></i> <span>Sign Out</span></a>
							</li>
						</ul>
					</div>

					<!--sidebar nav start-->
					<ul class="nav nav-pills nav-stacked custom-nav">
						<li>
							<a href="index.html"><i class="fa fa-home"></i> <span>首页</span></a>
						</li>
						<li class="menu-list">
							<a href=""><i class="fa fa-laptop"></i> <span>广告管理</span></a>
							<ul class="sub-menu-list">
								<li>
									<a href="blank_page.html"> app banner管理</a>
								</li>
								<li>
									<a href="boxed_view.html"> 关于我们</a>
								</li>
								<li>
									<a href="user_fw.html"> 青木易家用户服务协议</a>
								</li>
							</ul>
						</li>
						<li class="menu-list">
							<a href=""><i class="fa fa-book"></i> <span> 新手技能培训</span></a>
							<ul class="sub-menu-list">
								<li>
									<a href="general.html"> 公司奖惩制度</a>
								</li>
								<li>
									<a href="buttons.html"> 礼貌服务要求</a>
								</li>
								<li>
									<a href="tabs-accordions.html"> 施工流程方法</a>
								</li>
								<li>
									<a href="exam.html"> 新手考试题目</a>
								</li>
							</ul>
						</li>
						<li class="menu-list">
							<a href=""><i class="fa fa-cogs"></i> <span> 用户管理</span></a>
							<ul class="sub-menu-list">
								<li>
									<a href="userlist.html"> 用户列表</a>
								</li>
								<li>
									<a href="blacklist.html"> 黑名单</a>
								</li>
							</ul>
						</li>

						<!-- <li><a href="orderlist.html"><i class="fa fa-bullhorn"></i> <span> 订单管理</span></a></li>-->
						<li class="menu-list">
							<a href=""><i class="fa fa-cogs"></i> <span>订单管理</span></a>
							<ul class="sub-menu-list">
								<li>
									<a href="orderlist.html"> 订单列表</a>
								</li>
								<li>
									<a href="backlist.html"> 退单列表</a>
								</li>
							</ul>
						</li>

						<li class="menu-list">
							<a href=""><i class="fa fa-envelope"></i> <span> 设备耗材</span></a>
							<ul class="sub-menu-list">
								<li><a href="new_supplies.html"> 耗材列表</a></li>
								<li>
									<a href="consumable_order.html"> 耗材订单</a>
								</li>
							</ul>
						</li>

						<li>
							<a href="drug_quota.html"><i class="fa fa-tasks"></i> <span> 药剂配额管理</span></a>
						</li>
						<li class="menu-list">
							<a href=""><i class="fa fa-bar-chart-o"></i> <span> 财务管理</span></a>
							<ul class="sub-menu-list">
								<li>
									<a href="order_allocation.html"> 订单额分配</a>
								</li>
								<li>
									<a href="cash_management.html"> 提现管理</a>
								</li>
								<li>
									<a href="bank_statement.html">流水</a>
								</li>
							</ul>
						</li>
						<li class="menu-list">
							<a href="#"><i class="fa fa-th-list"></i> <span> 消息管理</span></a>
							<ul class="sub-menu-list">
								<li>
									<a href="message_list.html"> 消息列表</a>
								</li>
							</ul>
						</li>
					</ul>
					<!--sidebar nav end-->

				</div>
			</div>
			<!-- left side end-->

			<!-- main content start-->
			<div class="main-content">

				<!-- header section start-->
				<div class="header-section">

					<!--toggle button start-->
					<a class="toggle-btn"><i class="fa fa-bars"></i></a>
					<!--toggle button end-->

					<!--search start-->
					<form class="searchform" action="http://view.jqueryfuns.com/2014/4/10/7_df25ceea231ba5f44f0fc060c943cdae/index.html" method="post">
						<input type="text" class="form-control" name="keyword" placeholder="Search here..." />
					</form>
					<!--search end-->

					<!--notification menu start -->
					<div class="menu-right">
						<ul class="notification-menu">
							<li>
								<a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
									<img src="../img/photos/user-avatar.png" alt="" /> John Doe
									<span class="caret"></span>
								</a>
								<ul class="dropdown-menu dropdown-menu-usermenu pull-right">
									<li><a href="modifyPass.html"><i class="fa fa-cog"></i>修改密码</a></li>
									<li>
										<a href="login.html"><i class="fa fa-sign-out"></i> 退出</a>
									</li>
								</ul>
							</li>

						</ul>
					</div>
					<!--notification menu end -->

				</div>
				<!-- header section end-->

				<!-- page heading start-->

				<!-- page heading end-->

				<!--body wrapper start-->
				<div class="wrapper">
					<div class="row">
						<div class="col-sm-12">
							<section class="panel">
								<from class="panel-body">
									<div class="row">
										<div class="col-xs-3">
											<span class="col-xs-5 user">订单号：</span>
											<input class="col-xs-7" id="orderNo" type="text" />
										</div>
										<div class="col-xs-3">
											<span class="col-xs-5 user">订单状态：</span>
											<select id="order">
												<option value="-1">请选择</option>
												<option value="00">可接单</option>
												<option value="01">已接单</option>
												<option value="02">已完成</option>
												<option value="03">已到账</option>
												<option value="04">订单处理中</option>
												<option value="05">申请退单中</option>
												<option value="06">退单审核通过</option>
												<option value="07">退单审核未通过</option>
												<option value="09">订单已取消</option>
											
											</select>
										</div>
										<div class="col-xs-6">
											<span class="col-xs-2 user col-xs-offset-1"> 下单日期：</span>
											<div class="input-append date form_datetime col-xs-3">
												<input size="16" type="text" id="orderCrtDate" value="" readonly class="col-xs-9">
												<span style="position:absolute;top:37px;" class="add-on"><i class="icon-th"></i></span>
											</div>
											<span style="position:absolute; left:48%;">--</span>
											<div class="input-append date form_datetime col-xs-3">
												<input size="16" type="text" id="orderUpdDate" value="" readonly class="col-xs-9">
												<span style="position:absolute;top:37px;" class="add-on"><i class="icon-th"></i></span>
											</div>
										</div>
									</div>
									<div class="row" style="margin-top: 28px;">
										<div class="col-xs-8">
											<span class="col-xs-2 user"> 施工日期：</span>
											<div class="input-append date form_datetime col-xs-3">
												<input size="16" type="text" value="" id="orderShiGongDateBegin" readonly class="col-xs-9">
												<span style="position:absolute;top:37px;" class="add-on"><i class="icon-th"></i></span>
											</div>
											<span style="position:absolute; left:40%;">--</span>
											<div class="input-append date form_datetime col-xs-3">
												<input size="16" type="text" value="" id="orderShiGongDateEnt" readonly class="col-xs-9">
												<span style="position:absolute;top:37px;" class="add-on"><i class="icon-th"></i></span>
											</div>
										</div>
										<button style="position: absolute;right:40%;" class="btn btn-info col-xs-1" onclick="tiaojianQuery(1,-1)" type="button">搜索
                                </button>
									</div>
								</from>
							</section>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-12">
							<section class="panel">
								<header class="panel-heading">
									订单管理
								</header>
								<div class="panel-body">
									<table class="table  table-hover general-table">
										<thead>
											<tr>
												<th>下单人</th>
												<th class="hidden-phone">下单人电话</th>
												<th>订单号</th>
												<th>地区</th>
												<th>房屋面积</th>
												<th>施工日期</th>
												<th>下单日期</th>
												<th>施工金额</th>
												<th>施工信息</th>
											</tr>
										</thead>
										<tbody class="orderList">
																
										</tbody>

										<tfooter>
											<tr>
												<td></td>
												<td>当前统计量</td>
												<td id="todayUserCount">0</td>
												<td></td>
												<td>当前交易金额</td>
												<td id="todayOrderAmt">0</td>
											</tr>
											<tr>
												<td></td>
												<td>用户总统计量</td>
												<td id="userCount">0</td>
												<td></td>
												<td>交易总金额</td>
												<td id="allOrderAmt">0</td>
											</tr>
											
										</tfooter>
									</table>
									<div class='isPage'>
										<!--<div class="tcdPageCode"></div>-->
									</div>
								</div>
							</section>
						</div>
					</div>
				</div>
				<!--body wrapper end-->

				<!--footer section start-->
				<footer>
					2014 &copy; AdminEx by ThemeBucket
				</footer>
				<!--footer section end-->

			</div>
			<!-- main content end-->
		</section>

		<!-- Placed js at the end of the document so the pages load faster -->
		<script src="../js/jquery-1.10.2.min.js"></script>
		<script src="../js/jquery-1.8.3.min.js"></script>
		<script src="../js/jquery.page.js"></script>
		
		<script src="../js/url.js"></script>
		<script src="../js/jquery-ui-1.9.2.custom.min.js"></script>
		<script src="../js/jquery-migrate-1.2.1.min.js"></script>
		<script src="../js/bootstrap.min.js"></script>
		<script src="../js/modernizr.min.js"></script>
		<script src="../js/jquery.nicescroll.js"></script>

		<script type="text/javascript">
			var pageNum =1; //当前页数
			var pageSize = 10; //当前每页条数
			var total=0;
		
			var bTestTag = true; //测试代码
			tiaojianQuery(pageNum)
			
			function tiaojianQuery(pageNum,isInit) {

				var orderNo = $("#orderNo").val();
				var orderShiGongDateEnt = $("#orderShiGongDateEnt").val();
				var orderShiGongDateBegin = $("#orderShiGongDateBegin").val();
				var orderCrtDate = $("#orderCrtDate").val();
				var orderUpdDate = $("#orderUpdDate").val();
				var myselect = document.getElementById("order");
				var index = myselect.selectedIndex; // selectedIndex代表的是你所选中项的index
				var orderFinish = myselect.options[index].value;
//				if(orderNo==''){
//					orderNo=null
//				}
//				if(orderShiGongDateEnt==''){
//					orderShiGongDateEnt=null
//				}if(orderShiGongDateBegin==''){
//					orderShiGongDateBegin=null
//				}if(orderCrtDate==''){
//					orderCrtDate=null
//				}if(orderUpdDate==''){
//					orderUpdDate=null
//				}
			if(orderFinish==-1){
					orderFinish=''
				}
				console.log(orderNo,orderShiGongDateEnt,orderShiGongDateBegin,orderCrtDate,orderUpdDate,orderFinish)
				$.ajax({
					type: "POST",
					//url: dataUrl + '/CommponyInfoController/queryOrderByDateOrNo.do',
					url: dataUrl + '/OrderInfoController/obtainOrderInfoList.do',
					async:false,
					contentType: 'application/json;charset=utf-8',
					dataType: "JSON",
					data:JSON.stringify({
						
						"orderNo": orderNo,
						"constructionDateEnt": orderUpdDate,
						"constructionDateBegin": orderCrtDate,
						"orderDateBegin": orderShiGongDateBegin,
						"orderDateEnt": orderShiGongDateEnt,
						"orderFinish": orderFinish,
						"pageNumber": pageNum,
						"pageSize": pageSize

					}),
					
					success: function(data) {
						console.log(data)
						$('#userCount').html(data.obj.statistics.count);
						$('#allOrderAmt').html(parseFloat(data.obj.statistics.totalAmount).toFixed(2));
						$('#todayUserCount').html(data.obj.orderCount)
						$('#todayOrderAmt').html(parseFloat(data.obj.allOrderAmt).toFixed(2))
						total =Math.ceil(data.obj.tatol/pageSize) ;
						
						
						/*新添加的代码，仅供测试使用*/
						if(bTestTag||isInit==-1){
							console.log("为什么没进来？")
							//window.location.reload()
							bTestTag = false
							isInit = !isInit
							page()
						}else{
							console.log("执行下一页")
						}
						
						
						
						
						/*新添加代码结束*/
						var orderInfoList=data.obj.orderInfoList;
						var html='';
						if(orderInfoList.length!=0){
						for(var i=0;i<orderInfoList.length;i++){
							if(orderInfoList[i].reserveConstructDateTime!=undefined){
								var year=orderInfoList[i].reserveConstructDateTime.substring(0,4);
									var month=orderInfoList[i].reserveConstructDateTime.substring(4,6);
									var data=orderInfoList[i].reserveConstructDateTime.substring(6,8);
									var  hour=orderInfoList[i].reserveConstructDateTime.substring(8,10);
									var minute=orderInfoList[i].reserveConstructDateTime.substring(10,12);
									var second=orderInfoList[i].reserveConstructDateTime.substring(12,14);
									
									time=year+'-'+month+'-'+data+' '+hour+':'+minute+':'+second;
							}
							if(orderInfoList[i].orderCrtDateTime!=undefined){
								var year1=orderInfoList[i].orderCrtDateTime.substring(0,4);
									var month1=orderInfoList[i].orderCrtDateTime.substring(4,6);
									var data1=orderInfoList[i].orderCrtDateTime.substring(6,8);
									var  hour1=orderInfoList[i].orderCrtDateTime.substring(8,10);
									var minute1=orderInfoList[i].orderCrtDateTime.substring(10,12);
									var second1=orderInfoList[i].orderCrtDateTime.substring(12,14);
									
									time1=year1+'-'+month1+'-'+data1+' '+hour1+':'+minute1+':'+second1;
							}
							html+='<tr>';
							html+='<td>'+orderInfoList[i].orderUserName+'</td>';
							html+='<td>'+orderInfoList[i].moblNo+'</td>';
							html+='<td>'+orderInfoList[i].orderNo+'</td>';
							html+='<td>'+orderInfoList[i].orderAddress+'</td>';
							html+='<td>'+orderInfoList[i].constructArea+'</td>';
							
							html+='<td>'+time+'</td>';
							html+='<td>'+time1+'</td>';
							html+='<td>'+orderInfoList[i].orderTxnAmt+'</td>';
							if(orderInfoList[i].orderFinishStat=="00"){
							html+='<td>可接单</td>';	
							}else if(orderInfoList[i].orderFinishStat=="01"){
							html+='<td>已接单</td>';		
							}else if(orderInfoList[i].orderFinishStat=="02"){
							html+='<td>已完成</td>';		
							}else if(orderInfoList[i].orderFinishStat=="03"){
							html+='<td>已到帐</td>';		
							}else if(orderInfoList[i].orderFinishStat=="04"){
							html+='<td>订单处理中</td>';		
							}else if(orderInfoList[i].orderFinishStat=="05"){
							html+='<td>申请退单中</td>';		
							}else if(orderInfoList[i].orderFinishStat=="06"){
							html+='<td>退单审核通过</td>';		
							}else if(orderInfoList[i].orderFinishStat=="07"){
							html+='<td>退单审核未通过</td>';		
							}else if(orderInfoList[i].orderFinishStat=="09"){
							html+='<td>订单已取消</td>';		
							}		
												
							html+='</tr>';
						}
						
						$('.orderList').html(html);						
					}else{
						$('.orderList').html('');	
					}
					}

				});
				
				

			}
			console.log(total)
			/* $(".tcdPageCode").createPage({
			        pageCount:total,
			        current:current,
			        backFn:function(p){
			        	
			          tiaojianQuery(p)
			         current=p
			        }
			    });*/
			 function page(){  //这段代码不能放在tiaojianQuery()函数内执行，会引起下一页出问题
			 	
			 	$(".tcdPageCode").remove();
   				 $(".isPage").append("<div class='tcdPageCode'></div>");
			 	
					$(".tcdPageCode").createPage({
				        pageCount:total,
				        current:1,
				        backFn:function(p){
				        	
				        	
				          tiaojianQuery(p)
				          
				        }
				    });
				}
		</script>

		<!--common scripts for all pages-->
		<script src="../js/scripts.js"></script>

		<!--日期的选择相关-->

		<script src="../js/bootstrap.min.js"></script>
		<script src="../js/bootstrap-datetimepicker-master/js/bootstrap-datetimepicker.js"></script>
		<script src="../js/bootstrap-datetimepicker-master/js/locales/bootstrap-datetimepicker.fr.js"></script>
		<script type="text/javascript">
			$(".form_datetime").datetimepicker({
				format: "yyyy-mm-dd",
				autoclose: true,
				todayBtn: true,
				pickerPosition: "bottom-left"
			});
			$(function() {
				$('#datetimepicker6').datetimepicker();
				$('#datetimepicker7').datetimepicker({
					useCurrent: false //Important! See issue #1075
				});
				$("#datetimepicker6").on("dp.change", function(e) {
					$('#datetimepicker7').data("DateTimePicker").minDate(e.date);
				});
				$("#datetimepicker7").on("dp.change", function(e) {
					$('#datetimepicker6').data("DateTimePicker").maxDate(e.date);
				});
			});
		</script>
		<!--日期的选择相关结束-->
	</body>

</html>