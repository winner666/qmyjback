<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="ThemeBucket">
  <link rel="shortcut icon" href="#" type="image/png">

  <title>耗材列表</title>
    <style>
        #add-btn{padding:5px 30px;
            margin-left:10px;
            border-radius:5px;
            border:1px solid #eee;
            font-size:18px;
        }
        #select>p>input{width:400px;}
        .look{cursor: pointer;}
    </style>
  <link href="../css/style1.css" rel="stylesheet">
  <link href="../css/style-responsive.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="../js/html5shiv.js"></script>
  <script src="../js/respond.min.js"></script>

  <script src="../js/jquery-1.4.3.js"></script>
  <![endif]-->
</head>

<body class="sticky-header">

<section>
    <!-- left side start-->
    <div class="left-side sticky-left-side">

        <!--logo and iconic logo start-->
        <div class="logo">
            <a href="index.html"><img src="../img/logo1.png" alt=""></a>
        </div>

        <div class="logo-icon text-center">
            <a href="index.html"><img src="../img/logo_icon.png" alt=""></a>
        </div>
        <!--logo and iconic logo end-->


        <div class="left-side-inner">

            <!-- visible to small devices only -->
            <div class="visible-xs hidden-sm hidden-md hidden-lg">
                <div class="media logged-user">
                    <img alt="" src="../img/photos/user-avatar.png" class="media-object">
                    <div class="media-body">
                        <h4><a href="#">John Doe</a></h4>
                        <span>"Hello There..."</span>
                    </div>
                </div>

                <h5 class="left-nav-title">Account Information</h5>
                <ul class="nav nav-pills nav-stacked custom-nav">
                    <li><a href="#"><i class="fa fa-user"></i> <span>Profile</span></a></li>
                    <li><a href="#"><i class="fa fa-cog"></i> <span>Settings</span></a></li>
                    <li><a href="#"><i class="fa fa-sign-out"></i> <span>Sign Out</span></a></li>
                </ul>
            </div>

            <!--sidebar nav start-->
            <ul class="nav nav-pills nav-stacked custom-nav">
                <li><a href="index.html"><i class="fa fa-home"></i> <span>首页</span></a>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-laptop"></i> <span>广告管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="blank_page.html"> app banner管理</a></li>
                        <li><a href="boxed_view.html"> 关于我们</a></li>
                        <li><a href="user_fw.html"> 青木易家用户服务协议</a></li>
                        <li><a href="userUseText.html"> 用户使用说明</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-book"></i> <span> 新手技能培训</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="general.html"> 公司奖惩制度</a></li>
                        <li><a href="buttons.html"> 礼貌服务要求</a></li>
                        <li><a href="tabs-accordions.html"> 施工流程方法</a></li>
                        <li><a href="exam.html"> 新手考试题目</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-cogs"></i> <span> 用户管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="userlist.html"> 用户列表</a></li>
                        <li><a href="blacklist.html"> 黑名单</a></li>
                    </ul>
                </li>

               <!-- <li><a href="orderlist.html"><i class="fa fa-bullhorn"></i> <span> 订单管理</span></a></li>-->
               <li class="menu-list"><a href=""><i class="fa fa-cogs"></i> <span>订单管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="orderlist.html"> 订单列表</a></li>
                        <li><a href="backlist.html"> 退单列表</a></li>
                    </ul>
                </li>

                <li class="menu-list"><a href=""><i class="fa fa-envelope"></i> <span> 设备耗材</span></a>
                    <ul style="display: block;" class="sub-menu-list">
                        <li><a href="new_supplies.html"> 耗材列表</a></li>
                        <li><a href="consumable_order.html"> 耗材订单</a></li>
                    </ul>
                </li>

                <li><a href="drug_quota.html"><i class="fa fa-tasks"></i> <span> 药剂配额管理</span></a>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-bar-chart-o"></i> <span> 财务管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="order_allocation.html"> 订单额分配</a></li>
                        <li><a href="cash_management.html"> 提现管理</a></li>
                        <li><a href="bank_statement.html">流水</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href="#"><i class="fa fa-th-list"></i> <span> 消息管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="message_list.html"> 消息列表</a></li>
                    </ul>
                </li>
            </ul>
            <!--sidebar nav end-->

        </div>
    </div>
    <!-- left side end-->

    <!-- main content start-->
    <div class="main-content" >

        <!-- header section start-->
        <div class="header-section">

        <!--toggle button start-->
        <a class="toggle-btn"><i class="fa fa-bars"></i></a>
        <!--toggle button end-->

        <!--search start-->
        <form class="searchform" action="http://view.jqueryfuns.com/2014/4/10/7_df25ceea231ba5f44f0fc060c943cdae/index.html" method="post">
            <input type="text" class="form-control" name="keyword" placeholder="Search here..." />
        </form>
        <!--search end-->

        <!--notification menu start -->
            <div class="menu-right">
                <ul class="notification-menu">
                    <li>
                        <a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                            <img src="../img/photos/user-avatar.png" alt="" />
                            John Doe
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-usermenu pull-right">
                            <li><a href="modifyPass.html"><i class="fa fa-cog"></i>修改密码</a></li>
                            <li><a href="login.html"><i class="fa fa-sign-out"></i> 退出</a></li>
                        </ul>
                    </li>

                </ul>
            </div>
        <!--notification menu end -->

        </div>
        <!-- header section end-->

        <!-- page heading start-->
        <!-- page heading end-->

        <!--body wrapper start-->
        <div class="wrapper">
            <div class="row">
            <div class="col-sm-12">
                <section class="panel">
                    <header class="panel-heading">
                        <span style="font-size:18px;">耗材列表</span>
                        <!-- 按钮触发模态框 -->
                        <button id="add-btn" onclick="javascript:doit();">添加</button>
                        <!-- 按钮触发模态框 end-->
                        <form name="form"  id="documentForm">
                        <!-- 模态框（Modal） -->
                        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                		<div class="modal-header">
																				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
																					×
																				</button>
																				<h4 class="modal-title" id="myModalLabel">
																						新增耗材
																				</h4>
																		</div>
                                   
                                    <div id="select" style="padding-left: 80px;margin-top:40px;padding-right:30px;">
                                        <p>耗材名称 ： <input id="name" name="consumName" type="text" placeholder="请输入耗材名称"></p>
                                        <p>图片路径：<div class="am-form-group am-form-file" id="adImg" > 
																					<div class="tpl-form-file-img" style='width:100%;height: 150px;border:1px solid #ccc;'>
																						<img src="" alt="" id="adShow" style="width: 100%;height: 100%;">
																					</div>
																					<!--<button type="button" class="am-btn am-btn-danger am-btn-sm">
														                                    <i class="am-icon-cloud-upload"></i> </button>-->
																					<input id="AddPicture" type="file" multiple="">
																				</div></p>
                                        <p>耗材说明 ： <input id="exa" name="consumExplanation" type="text"placeholder="请输入耗材说明内容" ></p>
                                        <p>耗材价格 ： <input id="price" name="consumUnitPrice" type="text"placeholder="请输入耗材价格"></p>
                                    </div>

                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default"
                                                data-dismiss="modal">关闭
                                        </button>
                                        <button type="button" class="btn btn-primary" id="add">
                                          		  添加
                                        </button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div><!-- /.modal -->
                        <!-- 模态框（Modal）end -->
                        </form>
                    </header>
                    <div class="panel-body">
                        <table class="table  table-hover general-table">
                            <thead>
                            <tr>
                                <th>耗材名称</th>
                                <th>耗材图片</th>
                                <th>耗材说明</th>
                                <th>耗材价格</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody class="goodsList">

                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
        </div>
        <!--body wrapper end-->

        <!--footer section start-->
        <footer>
            2014 &copy; AdminEx by ThemeBucket
        </footer>
        <!--footer section end-->
				<!--编辑模态框-->
					  <div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                		<div class="modal-header">
																				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
																					×
																				</button>
																				<h4 class="modal-title" id="myModalLabel">
																						编辑耗材
																				</h4>
																		</div>
                                   
                                    <div id="select" style="padding-left: 80px;margin-top:40px;padding-right:30px ;">
                                        <p>耗材名称 ： <input id="suppliesName" name="consumName" type="text" placeholder="请输入耗材名称"></p>
                                        <p>图片路径：<div class="am-form-group am-form-file" id="Img" >
																					<div class="tpl-form-file-img" style="width: 100%;height:150px;border:1px solid #ccc;">
																						<img src="" alt="" id="imgShow" style="width:100%;height:100%;">
																					</div>
																					<!--<button type="button" class="am-btn am-btn-danger am-btn-sm">
														                                    <i class="am-icon-cloud-upload"></i> </button>-->
																					<input id="Picture" type="file" multiple="">
																				</div></p>
                                        <p>耗材说明 ： <input id="suppliesInfor" name="suppliesInfor" type="text"placeholder="请输入耗材说明内容" ></p>
                                        <p>耗材价格 ： <input id="suppliesPrice" name="suppliesPrice" type="text"placeholder="请输入耗材价格"></p>
                                    </div>

                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default"
                                                data-dismiss="modal">关闭
                                        </button>
                                        <button type="button" class="btn btn-primary" id="editSure">
                                          	完成
                                        </button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div><!-- /.modal -->
				<!--end-->

    </div>
    <!-- main content end-->
</section>

<!-- Placed js at the end of the document so the pages load faster -->
<script src="../js/jquery-1.10.2.min.js"></script>
<script src="../js/url.js"></script>
<script src="../js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="../js/jquery-migrate-1.2.1.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/modernizr.min.js"></script>
<script src="../js/jquery.nicescroll.js"></script>
<script src="../js/moxie.js"></script>'
<script src="../js/plupload.dev.js"></script>
		<script src="../js/qiniu.js"></script>
<script type="text/javascript">
  $(function(){	
	
	var upImg;	
$(document).ready(function () {

    getTokenMessage();
    getToken()
});
/*获取七牛上传tocken方法
   * 在该ajax回调方法中,调用上传控件初始化方法*/
function getTokenMessage() {

    $.ajax({
      // url: 'http://192.168.0.169:8072/main/upToken',
       url:dataUrl+'/AdvPicController/upToken.do', 

        type: 'POST',
        data: {},
        cache: false,
        contentType: false,    //不可缺
        processData: false,    //不可缺
        dataType: 'json',
        success: function (data) {
            var obj = data;
           // console.log(data);
            /*初始化方法, param1:请求tocken|param2上传控件ID*/
            uploaderReady(obj.upToken, 'AddPicture');

        }
    });
}
function getToken() {

    $.ajax({
      // url: 'http://192.168.0.169:8072/main/upToken',
       url:dataUrl+'/AdvPicController/upToken.do', 

        type: 'POST',
        data: {},
        cache: false,
        contentType: false,    //不可缺
        processData: false,    //不可缺
        dataType: 'json',
        success: function (data) {
            var obj = data;
           // console.log(data);
            /*初始化方法, param1:请求tocken|param2上传控件ID*/
            uploader(obj.upToken, 'Picture');

        }
    });
}
//document.getElementById('AddPicture').on('click',function(){
//	uploader.start();
//})
/*上传图片*/
function uploaderReady(token, divId) {
    //alert(2)
    var uploader = Qiniu.uploader({
        runtimes: 'html5,flash,html4',
        browse_button: divId,//上传按钮的ID
        container: adImg,//上传按钮的上级元素ID
        drop_element: 'btn-uploader',
        max_file_size: '100mb',//最大文件限制
        dragdrop: false,
        chunk_size: '4mb',//分块大小
        //Ajax请求upToken的Url，**强烈建议设置**（服务端提供）
        uptoken: token,
        // 默认 false，key为文件名。若开启该选项，SDK会为每个文件自动生成key（文件名）
        // save_key: true,
        // 默认 false。若在服务端生成uptoken的上传策略中指定了 `sava_key`，则开启，SDK在前端将不对key进行任何处理
        //main: 'http://ojantumyo.bkt.clouddn.com/',//自己的七牛云存储空间域名
        //domain: 'http://osytnx67q.bkt.clouddn.com/',
        	domain: 'http://osytqedas.bkt.clouddn.com/',
        multi_selection: false,//是否允许同时选择多文件
        //文件类型过滤，这里限制为图片类型
        filters: {
            mime_types: [
                {title: "Image files", extensions: "jpg,jpeg,gif,png"}
            ]
        },
        auto_start: true,
        unique_names: true,
        init: {
            'FilesAdded': function (up, files) {
                //do something
            },
            'BeforeUpload': function (up, file) {
                //do something
            },
            'UploadProgress': function (up, file) {
                //可以在这里控制上传进度的显示
                //可参考七牛的例子
            },
            'UploadComplete': function () {
                //do something
            },
            'FileUploaded': function (up, file, info) {
                //每个文件上传成功后,处理相关的事情
                //console.log(up)
                //alert(3)
                var domain = up.getOption('domain');
                var res = eval('(' + info + ')');
                var sourceLink = domain + res.key; //**获取上传文件的链接地址**
                console.log(sourceLink);
							upImg=sourceLink;
                $('#adShow').attr('src', sourceLink);

            },
            'Error': function (up, err, errTip) {
                //alert(errTip);
            },
            'Key': function (up, file) {
                //当save_key和unique_names设为false时，该方法将被调用
                return "";
            }
        }
    });
    uploader.start();
}
	
	function uploader(token, divId) {
    //alert(2)
    var uploader = Qiniu.uploader({
        runtimes: 'html5,flash,html4',
        browse_button: divId,//上传按钮的ID
        container: Img,//上传按钮的上级元素ID
        drop_element: 'btn-uploader',
        max_file_size: '100mb',//最大文件限制
        dragdrop: false,
        chunk_size: '4mb',//分块大小
        //Ajax请求upToken的Url，**强烈建议设置**（服务端提供）
        uptoken: token,
        // 默认 false，key为文件名。若开启该选项，SDK会为每个文件自动生成key（文件名）
        // save_key: true,
        // 默认 false。若在服务端生成uptoken的上传策略中指定了 `sava_key`，则开启，SDK在前端将不对key进行任何处理
        //main: 'http://ojantumyo.bkt.clouddn.com/',//自己的七牛云存储空间域名
        //domain: 'http://osytnx67q.bkt.clouddn.com/',
        	domain: 'http://osytqedas.bkt.clouddn.com/',
        multi_selection: false,//是否允许同时选择多文件
        //文件类型过滤，这里限制为图片类型
        filters: {
            mime_types: [
                {title: "Image files", extensions: "jpg,jpeg,gif,png"}
            ]
        },
        auto_start: true,
        unique_names: true,
        init: {
            'FilesAdded': function (up, files) {
                //do something
            },
            'BeforeUpload': function (up, file) {
                //do something
            },
            'UploadProgress': function (up, file) {
                //可以在这里控制上传进度的显示
                //可参考七牛的例子
            },
            'UploadComplete': function () {
                //do something
            },
            'FileUploaded': function (up, file, info) {
                //每个文件上传成功后,处理相关的事情
                //console.log(up)
                //alert(3)
                var domain = up.getOption('domain');
                var res = eval('(' + info + ')');
                var sourceLink = domain + res.key; //**获取上传文件的链接地址**
                console.log(sourceLink);
							upImg=sourceLink;
               // $('#adShow').attr('src', sourceLink);
               $("#imgShow").attr('src',sourceLink)

            },
            'Error': function (up, err, errTip) {
                //alert(errTip);
            },
            'Key': function (up, file) {
                //当save_key和unique_names设为false时，该方法将被调用
                return "";
            }
        }
    });
    uploader.start();
}
	
	 
	
  
    	list()
    	function list(){
        $.ajax({
            type: "GET",
            url:dataUrl+'/GoodsInfoController/queryGoodsList.do',
            data:{},
            dataType: "json",
            success: function(data){
            	console.log(data)
                var crmHtmlz2 = '';
                $.each(data,function(i,item){
                    $.each(item,function(i,dd){
                        /* crmHtmlz2 += "<tr><td>"+(i+1)+"</td><td>"+dd.content+"</td><td>"+dd.optionsa+"</td><td>"+dd.optionsb+"</td><td>"+dd.optionsc+"</td><td>"+dd.optionsd+"</td><td>"+dd.sure+"</td><td><a href=javascript:del(" + dd.id + ")>删除</a></td></tr>";
                         */ crmHtmlz2 += "<tr><td>"+dd.consumName+"</td><td url='"+dd.consumImg+"' class='look'>查看</td><td>"+dd.consumExplanation+"</td> <td>"+dd.consumUnitPrice+"</td><td><button class='edit' goodsId='"+dd.goodsId+"'>编辑</button><button class='cancle' goodsId='" + dd.goodsId + "'>删除</button></td></tr>"
                    });
                    $('.goodsList').html(crmHtmlz2);
                });
                $('.look').on('click',function(){
                	var imgurl=$(this).attr('url');
                location.href=imgurl;
                })
            
 							//点击删除
 							$('.cancle').click(function(){
 								var goodsId=$(this).attr('goodsId');console.log(goodsId)
 								 $.ajax({
                url: dataUrl+"/GoodsInfoController/deleteGoods.do",
                data:"goodsId="+goodsId,
                type: "post",
                success: function(data) {
                    if (data == "9999")
                        alert("删除失败！");
                    else {
                       alert("删除成功")
                     	list()
                    }
                }
            });
 							})
 							//点击编辑
 							$('.edit').click(function(){
 								var goodsId=$(this).attr('goodsId');
 								sessionStorage.setItem('goodsId',goodsId)
 								
 								 $(function () { $('#Modal').modal({
            				keyboard: true
        						})});
        						edit(goodsId)
 							})
            }
        });
       }
   	function edit(goodsId){


 					$.ajax({
            type: "post",
            url:dataUrl+'/GoodsInfoController/queryOneGoods.do',
            contentType:'application/json;charset=utf-8',
             dataType: "JSON",
            data:JSON.stringify({
            	   "goodsId":goodsId	
            }),
            dataType: "json",
            success: function(data){
            	var obj=data.goodsInfo
               $('#suppliesName').val(obj.consumName)
               $('#imgShow').attr('src',obj.consumImg)
               $('#suppliesInfor').val(obj.consumExplanation)
               $('#suppliesPrice').val(obj.consumUnitPrice)

            }
        });

   	}
   	
    function editQuestion(goodsId) {
   
        var name = $("#suppliesName").val();
         var exa = $("#suppliesInfor").val();
        var price = $("#suppliesPrice").val();
        var img=$('#imgShow').attr('src');
      	if(name==''){
      		alert('请输入材料名称');
      		return false
      	}
      
        if(img == ""  ){
            alert("图片不能为空");
            return false;
        }
        	if(exa==''){
      		alert('请输入材料说明');
      		return false;
      	}
        	if(price==''){
        		alert('请输入价格');
        		return false;
        	}
         $.ajax({
            type: "post",
            url:dataUrl+'/GoodsInfoController/updateGoods.do',
            contentType:'application/json;charset=utf-8',
             dataType: "JSON",
            data:JSON.stringify({
            	"goodsId":goodsId,
            	"consumName":name,
            	"consumUnitPrice":price,
            	"consumImg":upImg,
            	"consumExplanation":exa,
            	"consumTitle":''       	
            }),
            dataType: "json",
            success: function(data){
               console.log(data)
               if(data.code==0000){
               		//list()
               	//$('#Modal').hide()
               //	$('.modal-backdrop').hide()
               	location.reload()
               }

            }
        });
       
    };
    
$('#editSure').click(function(){
	var goodsId=sessionStorage.getItem('goodsId');
	editQuestion(goodsId)
})
    function addQuestion() {
   
        var name = $("#name").val();
         var exa = $("#exa").val();
        var price = $("#price").val();
      	if(name==''){
      		alert('请输入材料名称');
      		return false
      	}
      
        if(upImg == ""  ){
            alert("图片不能为空");
            return false;
        }
        	if(exa==''){
      		alert('请输入材料说明');
      		return false;
      	}
        	if(price==''){
        		alert('请输入价格');
        		return false;
        	}
         $.ajax({
            type: "post",
            url:dataUrl+'/GoodsInfoController/addGoods.do',
            contentType:'application/json;charset=utf-8',
             dataType: "JSON",
            data:JSON.stringify({
            	"consumName":name,
            	"consumUnitPrice":price,
            	"consumImg":upImg,
            	"consumExplanation":exa,
            	"consumTitle":''       	
            }),
            dataType: "json",
            success: function(data){
               console.log(data)
               if(data.code==0000){
               		list()
               	$('#myModal').hide()
               	$('.modal-backdrop').hide()
               }

            }
        });
       
    };
    
   $('#add').on('click',function(){
   		addQuestion() 
   })
    
   
    
     });
</script>
<!--common scripts for all pages-->
<script src="../js/scripts.js"></script>
<!--添加耗材的模态框-->
<script>
    function doit(){
        $(function () { $('#myModal').modal({
            keyboard: true
        })});
    }
   
</script>
<!--添加试题的模态框 enf-->
<!--点击查看的模态框-->
<script>
    function click_to_view(){
        $(function () { $('#myModals').modal({
            keyboard: true
        })});
    }
</script>
<!--点击查看的模态框 enf-->
</body>
</html>
